<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba WhatsApp - Almac√©n Copihue</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: #f0f9f0; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .container { 
            background: white; 
            border-radius: 15px; 
            padding: 30px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); 
            margin-top: 20px; 
        }
        h1 { 
            color: #2e7d32; 
            text-align: center; 
            margin-bottom: 30px; 
        }
        .producto { 
            background: #e8f5e9; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .botones { 
            display: flex; 
            gap: 10px; 
            align-items: center; 
        }
        button { 
            background: #2e7d32; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: bold; 
            transition: all 0.3s; 
        }
        button:hover { 
            background: #1b5e20; 
            transform: translateY(-2px); 
        }
        .whatsapp-btn { 
            background: #25D366; 
            margin-top: 30px; 
            width: 100%; 
            padding: 15px; 
            font-size: 18px; 
        }
        .whatsapp-btn:hover { 
            background: #1da851; 
        }
        .carrito-info { 
            background: #ffeb3b; 
            padding: 15px; 
            border-radius: 10px; 
            margin: 20px 0; 
            text-align: center; 
            font-weight: bold; 
        }
        .debug-btn { 
            background: #2196F3; 
            margin-top: 10px; 
        }
        .debug-btn:hover { 
            background: #0b7dda; 
        }
        .test-buttons { 
            display: flex; 
            gap: 10px; 
            margin-top: 20px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõí Prueba WhatsApp - Almac√©n Copihue</h1>
        
        <div class="carrito-info">
            Productos en carrito: <span id="cartCount">0</span> | 
            Total: $<span id="cartTotal">0</span>
        </div>
        
        <div id="productos">
            <!-- Productos se generan aqu√≠ -->
        </div>
        
        <button class="whatsapp-btn" id="sendWhatsApp">
            üì± ENVIAR PEDIDO POR WHATSAPP
        </button>
        
        <div class="test-buttons">
            <button class="debug-btn" onclick="testWhatsAppSimple()">
                üß™ Test Simple WhatsApp
            </button>
            <button class="debug-btn" onclick="testWhatsAppOrder()">
                üõí Test con Pedido
            </button>
        </div>
        
        <div style="margin-top: 30px; padding: 15px; background: #e3f2fd; border-radius: 10px;">
            <h3>üîç Instrucciones de prueba:</h3>
            <p>1. Agrega productos con los botones "+"</p>
            <p>2. Usa "Test con Pedido" para probar r√°pido</p>
            <p>3. Luego usa el bot√≥n verde grande</p>
            <p>4. Si no funciona, usa "Test Simple WhatsApp"</p>
        </div>
    </div>

    <script>
        // ========== DATOS DE PRUEBA ==========
        const productos = [
            { id: 1, nombre: "TOMATE KG", precio: 500, imagen: "üçÖ" },
            { id: 2, nombre: "DURAZNO UNIDAD", precio: 350, imagen: "üçë" },
            { id: 3, nombre: "LECHUGA", precio: 800, imagen: "ü•¨" },
            { id: 4, nombre: "MANZANA KG", precio: 1200, imagen: "üçé" }
        ];

        let carrito = [];
        const phoneNumber = "5492944907380"; // TU N√öMERO

        // ========== FUNCIONES B√ÅSICAS ==========
        function init() {
            renderProductos();
            updateCarritoDisplay();
            
            // Event listener para WhatsApp
            document.getElementById('sendWhatsApp').addEventListener('click', enviarPedidoWhatsApp);
        }

        function renderProductos() {
            const container = document.getElementById('productos');
            container.innerHTML = productos.map(producto => `
                <div class="producto">
                    <div>
                        <strong>${producto.imagen} ${producto.nombre}</strong><br>
                        <small>$${producto.precio}</small>
                    </div>
                    <div class="botones">
                        <button onclick="removeFromCart(${producto.id})">-</button>
                        <span id="qty${producto.id}">0</span>
                        <button onclick="addToCart(${producto.id})">+</button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(productId) {
            const producto = productos.find(p => p.id === productId);
            const item = carrito.find(item => item.id === productId);
            
            if (item) {
                item.cantidad++;
            } else {
                carrito.push({
                    id: producto.id,
                    nombre: producto.nombre,
                    precio: producto.precio,
                    cantidad: 1
                });
            }
            
            updateCarritoDisplay();
        }

        function removeFromCart(productId) {
            const itemIndex = carrito.findIndex(item => item.id === productId);
            
            if (itemIndex !== -1) {
                if (carrito[itemIndex].cantidad > 1) {
                    carrito[itemIndex].cantidad--;
                } else {
                    carrito.splice(itemIndex, 1);
                }
            }
            
            updateCarritoDisplay();
        }

        function updateCarritoDisplay() {
            // Actualizar contador
            const totalItems = carrito.reduce((sum, item) => sum + item.cantidad, 0);
            const totalPrice = carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            
            document.getElementById('cartCount').textContent = totalItems;
            document.getElementById('cartTotal').textContent = totalPrice;
            
            // Actualizar cantidades por producto
            productos.forEach(producto => {
                const item = carrito.find(item => item.id === producto.id);
                document.getElementById(`qty${producto.id}`).textContent = item ? item.cantidad : 0;
            });
        }

        // ========== WHATSAPP - VERSI√ìN SEGURA ==========
        function enviarPedidoWhatsApp() {
            console.log("üéØ Funci√≥n WhatsApp ejecutada");
            
            if (carrito.length === 0) {
                alert("‚ö†Ô∏è El carrito est√° vac√≠o. Agrega productos primero.");
                return;
            }
            
            // Construir mensaje SIMPLE
            let mensaje = `*üõí PEDIDO DE PRUEBA - ALMAC√âN COPIHUE*\n`;
            mensaje += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            
            carrito.forEach(item => {
                mensaje += `‚úÖ ${item.nombre}\n`;
                mensaje += `   ${item.cantidad} √ó $${item.precio} = $${item.precio * item.cantidad}\n\n`;
            });
            
            const total = carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            mensaje += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            mensaje += `üíµ *TOTAL: $${total}*\n\n`;
            mensaje += `üìç Retiro en Copihue 457\n`;
            mensaje += `‚è∞ 11:30 a 23:30 hs\n\n`;
            mensaje += `Gracias por la prueba!`;
            
            console.log("Mensaje:", mensaje);
            
            // Codificar para URL
            const mensajeCodificado = encodeURIComponent(mensaje);
            const whatsappURL = `https://wa.me/${phoneNumber}?text=${mensajeCodificado}`;
            
            console.log("URL generada:", whatsappURL);
            
            // Intentar abrir
            abrirWhatsApp(whatsappURL);
        }

        function abrirWhatsApp(url) {
            // Detectar si es m√≥vil
            const esMovil = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            if (esMovil) {
                // Para m√≥viles: intentar abrir la app
                window.location.href = url.replace('https://wa.me/', 'whatsapp://send?phone=');
                
                // Fallback despu√©s de 1 segundo
                setTimeout(() => {
                    window.open(url, '_blank');
                }, 1000);
            } else {
                // Para escritorio
                const nuevaVentana = window.open(url, '_blank');
                
                if (!nuevaVentana) {
                    alert("‚ö†Ô∏è El navegador bloque√≥ la ventana. Permite popups para WhatsApp.");
                    // Intentar de otra forma
                    window.location.href = url;
                }
            }
            
            // Opcional: limpiar carrito despu√©s de enviar
            setTimeout(() => {
                carrito = [];
                updateCarritoDisplay();
            }, 2000);
        }

        // ========== FUNCIONES DE TEST ==========
        function testWhatsAppSimple() {
            console.log("üß™ Test simple WhatsApp");
            
            const mensaje = "‚úÖ PRUEBA EXITOSA desde Almac√©n Copihue";
            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(mensaje)}`;
            
            console.log("URL test:", url);
            abrirWhatsApp(url);
        }

        function testWhatsAppOrder() {
            console.log("üß™ Test con pedido de ejemplo");
            
            // Agregar productos de ejemplo
            carrito = [
                { id: 1, nombre: "TOMATE KG", precio: 500, cantidad: 2 },
                { id: 2, nombre: "DURAZNO UNIDAD", precio: 350, cantidad: 3 }
            ];
            
            updateCarritoDisplay();
            
            // Esperar y enviar
            setTimeout(() => {
                enviarPedidoWhatsApp();
            }, 500);
        }

        // ========== INICIAR ==========
        document.addEventListener('DOMContentLoaded', init);
        
        // Tambi√©n expone funciones para consola
        window.debugCarrito = () => {
            console.log("Carrito actual:", carrito);
            console.log("Total items:", carrito.reduce((sum, item) => sum + item.cantidad, 0));
            console.log("Total precio:", carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0));
        };
    </script>
</body>
</html>